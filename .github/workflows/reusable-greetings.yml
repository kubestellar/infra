name: Reusable Greetings

on:
  workflow_call:
    inputs:
      pr_message:
        description: 'Message to post for PR contributors'
        required: false
        type: string
        default: |
          Welcome to KubeStellar! ğŸš€ Thank you for submitting this Pull Request.

          **Before your PR can be merged, please ensure:**

          âœ… **DCO Sign-off** - All commits must be signed off with `git commit -s` to certify the <a href="https://developercertificate.org/" target="_blank">Developer Certificate of Origin</a>

          âœ… **PR Title** - Must start with an emoji: âœ¨ (feature), ğŸ› (bug fix), ğŸ“– (docs), ğŸŒ± (infra/tests), âš ï¸ (breaking change)

          **Getting Started with KubeStellar:**
          - ğŸ“¦ <a href="https://kubestellar.io/docs/user-guide/quick-start" target="_blank">Quick Start</a>
          - ğŸ“– <a href="https://docs.kubestellar.io/" target="_blank">Documentation</a>
          - ğŸ¬ <a href="https://www.youtube.com/@kubestellar" target="_blank">YouTube - Getting Started & Contributing</a>

          **Contributor Resources:**
          - ğŸ“š <a href="https://kubestellar.io/contribute-handbook" target="_blank">Contributor Handbook</a>
          - ğŸªœ <a href="https://kubestellar.io/ladder" target="_blank">Contributor Ladder</a>
          - ğŸ“ <a href="https://kubestellar.io/programs" target="_blank">Mentorship Programs (LFX, GSoC)</a>
          - ğŸ’¬ <a href="https://cloud-native.slack.com/archives/C097094RZ3M" target="_blank">Slack - #kubestellar-dev</a>

          ---

          ğŸŒŸ **Help KubeStellar Grow - We Need Adopters!**

          Our roadmap is driven entirely by adopter feedback. Whether you're using KubeStellar yourself or know someone who could benefit from multi-cluster Kubernetes:

          ğŸ“‹ <a href="https://forms.gle/VsG6aJpikf3NKjJH6" target="_blank"><b>Take our Multi-Cluster Survey</b></a> - Share your use cases and help shape our direction!

          ---

          A maintainer will review your PR soon. Feel free to ask questions in the comments or on Slack!
      issue_message:
        description: 'Message to post for issue creators'
        required: false
        type: string
        default: |
          Welcome to KubeStellar! ğŸš€ Thank you for opening this issue.

          **To work on this issue**, use the slash command:
          ```
          /assign
          ```
          This will automatically assign the issue to you. Use `/unassign` to remove yourself.

          **Find Issues to Work On:**
          - ğŸ·ï¸ <a href="https://github.com/kubestellar/kubestellar/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22" target="_blank"><code>good first issue</code></a> - Great for new contributors
          - ğŸ™‹ <a href="https://github.com/kubestellar/kubestellar/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22" target="_blank"><code>help wanted</code></a> - Community help needed
          - ğŸ” <a href="https://clotributor.dev/search?project=kubestellar" target="_blank">CLOTributor</a> - CNCF issue finder

          **Getting Started with KubeStellar:**
          - ğŸ“¦ <a href="https://kubestellar.io/docs/user-guide/quick-start" target="_blank">Quick Start</a>
          - ğŸ“– <a href="https://docs.kubestellar.io/" target="_blank">Documentation</a>
          - ğŸ¬ <a href="https://www.youtube.com/@kubestellar" target="_blank">YouTube - Getting Started & Contributing</a>

          **Contributor Resources:**
          - ğŸ“š <a href="https://kubestellar.io/contribute-handbook" target="_blank">Contributor Handbook</a>
          - ğŸªœ <a href="https://kubestellar.io/ladder" target="_blank">Contributor Ladder</a>
          - ğŸ“ <a href="https://kubestellar.io/programs" target="_blank">Mentorship Programs (LFX, GSoC)</a>
          - ğŸ’¬ <a href="https://cloud-native.slack.com/archives/C097094RZ3M" target="_blank">Slack - #kubestellar-dev</a>

          **For Maintainers - Label Commands:**
          - `/good-first-issue` - Mark this issue as suitable for new contributors
          - `/help-wanted` - Mark this issue as needing community help

          ---

          ğŸŒŸ **Help KubeStellar Grow - We Need Adopters!**

          Our roadmap is driven entirely by adopter feedback. Whether you're using KubeStellar yourself or know organizations that could benefit from multi-cluster Kubernetes:

          ğŸ“‹ <a href="https://forms.gle/VsG6aJpikf3NKjJH6" target="_blank"><b>Take our Multi-Cluster Survey</b></a> - Share your use cases and help shape our direction!

          ---

          We're excited to have you in our community!

permissions:
  contents: read

jobs:
  greeting:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Greet contributor
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        env:
          PR_MESSAGE: ${{ inputs.pr_message }}
          ISSUE_MESSAGE: ${{ inputs.issue_message }}
        with:
          script: |
            const { owner, repo } = context.repo;
            const author = context.payload.pull_request?.user?.login || context.payload.issue?.user?.login;
            const isPR = !!context.payload.pull_request;
            const itemNumber = context.payload.pull_request?.number || context.payload.issue?.number;

            if (!author || !itemNumber) {
              console.log('Could not determine author or item number');
              return;
            }

            // Skip bots
            if (author.endsWith('[bot]') || author === 'dependabot' || author === 'github-actions') {
              console.log(`Skipping bot: ${author}`);
              return;
            }

            console.log(`Greeting ${author} for ${isPR ? 'PR' : 'issue'} #${itemNumber}`);

            const message = isPR ? process.env.PR_MESSAGE : process.env.ISSUE_MESSAGE;

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: itemNumber,
              body: message
            });

            console.log('Greeting posted successfully');
