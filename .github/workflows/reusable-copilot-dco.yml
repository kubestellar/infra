name: Copilot DCO Override

on:
  workflow_call:

jobs:
  copilot-dco:
    runs-on: ubuntu-latest
    if: github.event.pull_request.user.login == 'copilot-swe-agent[bot]'
    steps:
      - name: Set DCO status for Copilot
        uses: actions/github-script@v7
        with:
          script: |
            // Set the DCO status context to success for Copilot PRs
            await github.rest.repos.createCommitStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              sha: context.payload.pull_request.head.sha,
              state: 'success',
              context: 'dco',
              description: 'DCO waived for Copilot',
              target_url: 'https://github.com/kubestellar/kubestellar/blob/master/CONTRIBUTING.md'
            });

            // Remove dco-signoff: no label if present
            try {
              await github.rest.issues.removeLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                name: 'dco-signoff: no'
              });
            } catch (e) {
              // Label might not exist, ignore
              console.log('Label not found or already removed');
            }

            // Add dco-signoff: yes label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              labels: ['dco-signoff: yes']
            });
