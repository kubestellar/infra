name: Reusable PR Title Verifier

on:
  workflow_call:

jobs:
  verify:
    runs-on: ubuntu-latest
    if: github.actor != 'dependabot[bot]' && github.actor != 'renovate[bot]'
    steps:
      - name: Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683

      - name: Validate PR Title Format
        env:
          TITLE: ${{ github.event.pull_request.title }}
        run: |
          set -euo pipefail

          if [ -z "${TITLE}" ]; then
            echo "Error: PR title cannot be empty."
            exit 1
          fi

          # Define allowed emoji prefixes (âš ï¸ âœ¨ ğŸ› ğŸ“– ğŸš€ ğŸŒ±)
          if ! printf '%s' "$TITLE" | grep -qE '^(âš |âœ¨|ğŸ›|ğŸ“–|ğŸš€|ğŸŒ±)'; then
            printf "Required indicator not found at the start of title: %q\n" "$TITLE"
            echo "Your PR title must start with one of the following:"
            echo "  âš  Warning sign (Breaking change)"
            echo "  âœ¨ Sparkles (Non-breaking feature)"
            echo "  ğŸ› Bug (Patch fix)"
            echo "  ğŸ“– Book (Documentation)"
            echo "  ğŸš€ Rocket (Release)"
            echo "  ğŸŒ± Seedling (Infra/Tests/Other)"
            exit 1
          fi

          printf "PR title is valid: '%q'\n" "$TITLE"
